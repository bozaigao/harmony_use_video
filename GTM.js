!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e||self)._analytics={})}(this,function(e){function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.apply(this,arguments)}var n=0;function r(e){return"__private_"+n+++"_"+e}function i(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var o=function(e){var t={exports:{}};return function(e,t){e.exports=function(e,t,n,r,i){for(t=t.split?t.split("."):t,r=0;r<t.length;r++)e=e?e[t[r]]:i;return e===i?n:e}}(t),t.exports}(),a=o,u="object";"undefined"==typeof process||process;var c="undefined"!=typeof document;function s(e,t){return t.charAt(0)[e]()+t.slice(1)}"undefined"!=typeof Deno&&Deno,c&&"nodejs"===window.name||"undefined"!=typeof navigator&&void 0!==navigator.userAgent&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"));var l=s.bind(null,"toUpperCase"),d=s.bind(null,"toLowerCase");function f(e,t){void 0===t&&(t=!0);var n=function(e){return h(e)?l("null"):"object"==typeof e?function(e){return m(e.constructor)?e.constructor.name:null}(e):Object.prototype.toString.call(e).slice(8,-1)}(e);return t?d(n):n}function p(e,t){return typeof t===e}var m=p.bind(null,"function"),g=p.bind(null,"string");p.bind(null,"undefined");var v=p.bind(null,"boolean");function h(e){return null===e}function y(e){if(!function(e){return e&&("object"==typeof e||null!==e)}(e))return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function b(e,t){if("object"!=typeof t||h(t))return!1;if(t instanceof e)return!0;var n=f(new e(""));if(function(e){return e instanceof Error||g(e.message)&&e.constructor&&function(e){return"number"===f(e)&&!isNaN(e)}(e.constructor.stackTraceLimit)}(t))for(;t;){if(f(t)===n)return!0;t=Object.getPrototypeOf(t)}return!1}function w(e,t){var n=e instanceof Element||e instanceof HTMLDocument;return n&&t?function(e,t){return void 0===t&&(t=""),e&&e.nodeName===t.toUpperCase()}(e,t):n}function _(e){var t=[].slice.call(arguments,1);return function(){return e.apply(void 0,[].slice.call(arguments).concat(t))}}function x(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function I(e,t,n){for(var r=t.length-1,i=0;i<r;++i){var o=t[i];if("__proto__"===o||"constructor"===o)break;o in e||(e[o]={}),e=e[o]}e[t[r]]=n}function P(){for(var e="",t=0,n=4294967295*Math.random()|0;t++<36;){var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"[t-1],i=15&n;e+="-"==r||"4"==r?r:("x"==r?i:3&i|8).toString(16),n=t%8==0?4294967295*Math.random()|0:n>>4}return e}p.bind(null,"symbol"),b.bind(null,TypeError),b.bind(null,SyntaxError),_(w,"form"),_(w,"button"),_(w,"input"),_(w,"select");var E="__global__",S=typeof self===u&&self.self===self&&self||typeof global===u&&global.global===global&&global||void 0;function k(e){return S[E][e]}function O(e,t){return S[E][e]=t}function j(e){delete S[E][e]}S[E]||(S[E]={});var T="function",A="undefined",N="reducer",D="@@redux/",M=D+"INIT",q=D+Math.random().toString(36),z=/* #__PURE__ */function(){return typeof Symbol===T&&Symbol.observable||"@@observable"}(),C=" != "+T;function U(e,t,n){var r;if(typeof t===T&&typeof n===A&&(n=t,t=void 0),typeof n!==A){if(typeof n!==T)throw new Error("enhancer"+C);return n(U)(e,t)}if(typeof e!==T)throw new Error(N+C);var i=e,o=t,a=[],u=a,c=!1;function s(){u===a&&(u=a.slice())}function l(){return o}function d(e){if(typeof e!==T)throw new Error("Listener"+C);var t=!0;return s(),u.push(e),function(){if(t){t=!1,s();var n=u.indexOf(e);u.splice(n,1)}}}function f(e){if(!y(e))throw new Error("Act != obj");if(typeof e.type===A)throw new Error("ActType "+A);if(c)throw new Error("Dispatch in "+N);try{c=!0,o=i(o,e)}finally{c=!1}for(var t=a=u,n=0;n<t.length;n++)(0,t[n])();return e}return f({type:M}),(r={dispatch:f,subscribe:d,getState:l,replaceReducer:function(e){if(typeof e!==T)throw new Error("next "+N+C);i=e,f({type:M})}})[z]=function(){var e,t=d;return(e={subscribe:function(e){if("object"!=typeof e)throw new TypeError("Observer != obj");function n(){e.next&&e.next(l())}return n(),{unsubscribe:t(n)}}})[z]=function(){return this},e},r}function L(e,t){var n=t&&t.type;return"action "+(n&&n.toString()||"?")+N+" "+e+" returns "+A}function R(){var e=[].slice.call(arguments);return 0===e.length?function(e){return e}:1===e.length?e[0]:e.reduce(function(e,t){return function(){return e(t.apply(void 0,[].slice.call(arguments)))}})}function V(){var e=arguments;return function(n){return function(r,i,o){var a,u=n(r,i,o),c=u.dispatch,s={getState:u.getState,dispatch:function(e){return c(e)}};return a=[].slice.call(e).map(function(e){return e(s)}),t({},u,{dispatch:c=R.apply(void 0,a)(u.dispatch)})}}}var $="__anon_id",B="__user_id",H="__user_traits",J="analytics",X="userId",F="anonymousId",G=["bootstrap","params","campaign","initializeStart","initialize","initializeEnd","ready","resetStart","reset","resetEnd","pageStart","page","pageEnd","pageAborted","trackStart","track","trackEnd","trackAborted","identifyStart","identify","identifyEnd","identifyAborted","userIdChanged","registerPlugins","enablePlugin","disablePlugin","online","offline","setItemStart","setItem","setItemEnd","setItemAborted","removeItemStart","removeItem","removeItemEnd","removeItemAborted"],K=["name","EVENTS","config","loaded"],W=G.reduce(function(e,t){return e[t]=t,e},{registerPluginType:function(e){return"registerPlugin:"+e},pluginReadyType:function(e){return"ready:"+e}}),Q=/^utm_/,Y=/^an_prop_/,Z=/^an_trait_/;function ee(e){var n=e.storage.setItem;return function(r){return function(i){return function(o){if(o.type===W.bootstrap){var a=o.params,u=o.user,c=o.persistedUser,s=o.initialUser,l=c.userId===u.userId;c.anonymousId!==u.anonymousId&&n($,u.anonymousId),l||n(B,u.userId),s.traits&&n(H,t({},l&&c.traits?c.traits:{},s.traits));var d=Object.keys(o.params);if(d.length){var f=a.an_uid,p=a.an_event,m=d.reduce(function(e,t){if(t.match(Q)||t.match(/^(d|g)clid/)){var n=t.replace(Q,"");e.campaign["campaign"===n?"name":n]=a[t]}return t.match(Y)&&(e.props[t.replace(Y,"")]=a[t]),t.match(Z)&&(e.traits[t.replace(Z,"")]=a[t]),e},{campaign:{},props:{},traits:{}});r.dispatch(t({type:W.params,raw:a},m,f?{userId:f}:{})),f&&setTimeout(function(){return e.identify(f,m.traits)},0),p&&setTimeout(function(){return e.track(p,m.props)},0),Object.keys(m.campaign).length&&r.dispatch({type:W.campaign,campaign:m.campaign})}}return i(o)}}}}function te(e){return function(n,r){if(void 0===n&&(n={}),void 0===r&&(r={}),r.type===W.setItemEnd){if(r.key===$)return t({},n,{anonymousId:r.value});if(r.key===B)return t({},n,{userId:r.value})}switch(r.type){case W.identify:return Object.assign({},n,{userId:r.userId,traits:t({},n.traits,r.traits)});case W.reset:return[B,$,H].forEach(function(t){e.removeItem(t)}),Object.assign({},n,{userId:null,anonymousId:null,traits:{}});default:return n}}}function ne(e){return{userId:e.getItem(B),anonymousId:e.getItem($),traits:e.getItem(H)}}var re=function(e){return"__TEMP__"+e};function ie(e){var n=e.storage,r=n.setItem,i=n.removeItem,o=n.getItem;return function(e){return function(n){return function(a){var u=a.userId,c=a.traits,s=a.options;if(a.type===W.reset&&([B,H,$].forEach(function(e){i(e)}),[X,F,"traits"].forEach(function(e){j(re(e))})),a.type===W.identify){o($)||r($,P());var l=o(B),d=o(H)||{};l&&l!==u&&e.dispatch({type:W.userIdChanged,old:{userId:l,traits:d},new:{userId:u,traits:c},options:s}),u&&r(B,u),c&&r(H,t({},d,c))}return n(a)}}}}var oe={};function ae(e,t){oe[e]&&m(oe[e])&&(oe[e](t),delete oe[e])}function ue(e,n,r){return new Promise(function(i,o){return n()?i(e):r<1?o(t({},e,{queue:!0})):new Promise(function(e){return setTimeout(e,10)}).then(function(t){return ue(e,n,r-10).then(i,o)})})}function ce(e){return{abort:e}}var se=function(e){var n=e.data,r=e.action,i=e.instance,o=e.state,a=e.allPlugins,u=e.allMatches,c=e.store,s=e.EVENTS;try{var l=o.plugins,d=o.context,f=r.type,p=f.match(le),g=n.exact.map(function(e){return e.pluginName});p&&(g=u.during.map(function(e){return e.pluginName}));var v=function(e,n){return function(r,i,o){var a=i.config,u=i.name,c=u+"."+r.type;o&&(c=o.event);var s=r.type.match(le)?function(e,n,r,i,o){return function(a,u){var c=i?i.name:e,s=u&&we(u)?u:r;if(i&&(!(s=u&&we(u)?u:[e]).includes(e)||1!==s.length))throw new Error("Method "+n+" can only abort "+e+" plugin. "+JSON.stringify(s)+" input valid");return t({},o,{abort:{reason:a,plugins:s,caller:n,_:c}})}}(u,c,n,o,r):function(e,t){return function(){throw new Error(e.type+" action not cancellable. Remove abort in "+t)}}(r,c);return{payload:Ie(r),instance:e,config:a||{},abort:s}}}(i,g),h=n.exact.reduce(function(e,t){var n=t.pluginName,r=t.methodName,i=!1;return r.match(/^initialize/)||r.match(/^reset/)||(i=!l[n].loaded),d.offline&&r.match(/^(page|track|identify)/)&&(i=!0),e[""+n]=i,e},{});return Promise.resolve(n.exact.reduce(function(e,o,u){var c=o.pluginName;return Promise.resolve(e).then(function(e){function o(){return Promise.resolve(e)}var u=function(){if(n.namespaced&&n.namespaced[c])return Promise.resolve(n.namespaced[c].reduce(function(e,n,r){return Promise.resolve(e).then(function(e){return n.method&&m(n.method)?(function(e,t){var n=xe(e);if(n&&n.name===t){var r=xe(n.method);throw new Error([t+" plugin is calling method "+e,"Plugins cant call self","Use "+n.method+" "+(r?"or "+r.method:"")+" in "+t+" plugin insteadof "+e].join("\n"))}}(n.methodName,n.pluginName),Promise.resolve(n.method({payload:e,instance:i,abort:(r=e,o=c,u=n.pluginName,function(e,n){return t({},r,{abort:{reason:e,plugins:n||[o],caller:f,from:u||o}})}),config:ge(n.pluginName,l,a),plugins:l})).then(function(n){var r=y(n)?n:{};return Promise.resolve(t({},e,r))})):e;var r,o,u})},Promise.resolve(r))).then(function(t){e[c]=t});e[c]=r}();return u&&u.then?u.then(o):o()})},Promise.resolve({}))).then(function(e){return Promise.resolve(n.exact.reduce(function(r,o,u){try{var s=n.exact.length===u+1,d=o.pluginName,m=a[d];return Promise.resolve(r).then(function(n){var r=e[d]?e[d]:{};if(p&&(r=n),ye(r,d))return me({data:r,method:f,instance:i,pluginName:d,store:c}),Promise.resolve(n);if(ye(n,d))return s&&me({data:n,method:f,instance:i,store:c}),Promise.resolve(n);if(h.hasOwnProperty(d)&&!0===h[d])return c.dispatch({type:"queue",plugin:d,payload:r,_:{called:"queue",from:"queueMechanism"}}),Promise.resolve(n);var o=v(e[d],a[d]);return Promise.resolve(m[f]({abort:o.abort,payload:r,instance:i,config:ge(d,l,a),plugins:l})).then(function(o){var a=y(o)?o:{},u=t({},n,a),s=e[d];if(ye(s,d))me({data:s,method:f,instance:i,pluginName:d,store:c});else{var l=f+":"+d;(l.match(/:/g)||[]).length<2&&!f.match(de)&&!f.match(fe)&&i.dispatch(t({},p?u:r,{type:l,_:{called:l,from:"submethod"}}))}return Promise.resolve(u)})})}catch(e){return Promise.reject(e)}},Promise.resolve(r))).then(function(e){if(!(f.match(le)||f.match(/^registerPlugin/)||f.match(fe)||f.match(de)||f.match(/^params/)||f.match(/^userIdChanged/))){if(s.plugins.includes(f),e._&&e._.originalAction===f)return e;var r=t({},e,{_:{originalAction:e.type,called:e.type,from:"engineEnd"}});be(e,n.exact.length)&&!f.match(/End$/)&&(r=t({},r,{type:e.type+"Aborted"})),c.dispatch(r)}return e})})}catch(e){return Promise.reject(e)}},le=/Start$/,de=/^bootstrap/,fe=/^ready/,pe=function(e,n,r,i,o){try{var a=m(n)?n():n,u=e.type,c=u.replace(le,"");if(e._&&e._.called)return Promise.resolve(e);var s=r.getState(),l=(p=a,void 0===(g=s.plugins)&&(g={}),void 0===(h=e.options)&&(h={}),Object.keys(p).filter(function(e){var t=h.plugins||{};return v(t[e])?t[e]:!1!==t.all&&(!g[e]||!1!==g[e].enabled)}).map(function(e){return p[e]}));u===W.initializeStart&&e.fromEnable&&(l=Object.keys(s.plugins).filter(function(t){var n=s.plugins[t];return e.plugins.includes(t)&&!n.initialized}).map(function(e){return a[e]}));var d=l.map(function(e){return e.name}),f=function(e,t,n){var r=he(e).map(function(e){return ve(e,t)});return t.reduce(function(n,r){var i=r.name,o=he(e,i).map(function(e){return ve(e,t)}),a=o[0],u=o[1],c=o[2];return a.length&&(n.beforeNS[i]=a),u.length&&(n.duringNS[i]=u),c.length&&(n.afterNS[i]=c),n},{before:r[0],beforeNS:{},during:r[1],duringNS:{},after:r[2],afterNS:{}})}(u,l);return Promise.resolve(se({action:e,data:{exact:f.before,namespaced:f.beforeNS},state:s,allPlugins:a,allMatches:f,instance:r,store:i,EVENTS:o})).then(function(e){function n(){var n=function(){if(u.match(le))return Promise.resolve(se({action:t({},l,{type:c+"End"}),data:{exact:f.after,namespaced:f.afterNS},state:s,allPlugins:a,allMatches:f,instance:r,store:i,EVENTS:o})).then(function(e){e.meta&&e.meta.hasCallback&&ae(e.meta.rid,{payload:e})})}();return n&&n.then?n.then(function(){return e}):e}if(be(e,d.length))return e;var l,p=function(){if(u!==c)return Promise.resolve(se({action:t({},e,{type:c}),data:{exact:f.during,namespaced:f.duringNS},state:s,allPlugins:a,allMatches:f,instance:r,store:i,EVENTS:o})).then(function(e){l=e});l=e}();return p&&p.then?p.then(n):n()})}catch(e){return Promise.reject(e)}var p,g,h};function me(e){var n=e.pluginName,r=e.method+"Aborted"+(n?":"+n:"");e.store.dispatch(t({},e.data,{type:r,_:{called:r,from:"abort"}}))}function ge(e,t,n){var r=t[e]||n[e];return r&&r.config?r.config:{}}function ve(e,t){return t.reduce(function(t,n){return n[e]?t.concat({methodName:e,pluginName:n.name,method:n[e]}):t},[])}function he(e,t){var n=e.replace(le,""),r=t?":"+t:"";return[""+e+r,""+n+r,n+"End"+r]}function ye(e,t){var n=e.abort;return!!n&&(!0===n||_e(n,t)||n&&_e(n.plugins,t))}function be(e,t){var n=e.abort;if(!n)return!1;if(!0===n||g(n))return!0;var r=n.plugins;return we(n)&&n.length===t||we(r)&&r.length===t}function we(e){return Array.isArray(e)}function _e(e,t){return!(!e||!we(e))&&e.includes(t)}function xe(e){var t=e.match(/(.*):(.*)/);return!!t&&{method:t[1],name:t[2]}}function Ie(e){return Object.keys(e).reduce(function(t,n){return"type"===n||(t[n]=y(e[n])?Object.assign({},e[n]):e[n]),t},{})}function Pe(e,n,r){var i={};return function(o){return function(a){return function(u){try{var c,s=function(e){return c?e:a(f)},l=u.type,d=u.plugins,f=u;if(u.abort)return Promise.resolve(a(u));if(l===W.enablePlugin&&o.dispatch({type:W.initializeStart,plugins:d,disabled:[],fromEnable:!0,meta:u.meta}),l===W.disablePlugin&&setTimeout(function(){return ae(u.meta.rid,{payload:u})},0),l===W.initializeEnd){var p=n(),g=Object.keys(p),v=g.filter(function(e){return d.includes(e)}).map(function(e){return p[e]}),h=[],b=[],w=u.disabled,_=v.map(function(e){var t=e.loaded,n=e.name,r=e.config;return ue(e,function(){return t({config:r})},1e4).then(function(t){return i[n]||(o.dispatch({type:W.pluginReadyType(n),name:n,events:Object.keys(e).filter(function(e){return!K.includes(e)})}),i[n]=!0),h=h.concat(n),e}).catch(function(e){if(e instanceof Error)throw new Error(e);return b=b.concat(e.name),e})});Promise.all(_).then(function(e){var n={plugins:h,failed:b,disabled:w};setTimeout(function(){g.length===_.length+w.length&&o.dispatch(t({},{type:W.ready},n))},0)})}var x=function(){if(l!==W.bootstrap)return/^ready:([^:]*)$/.test(l)&&setTimeout(function(){return function(e,n,r){var i={},o=n(),a=e.getState(),u=a.plugins,c=a.queue,s=a.user;if(!a.context.offline&&c&&c.actions&&c.actions.length){var l=c.actions.reduce(function(e,t,n){return u[t.plugin].loaded?(e.process.push(t),e.processIndex.push(n)):(e.requeue.push(t),e.requeueIndex.push(n)),e},{processIndex:[],process:[],requeue:[],requeueIndex:[]});if(l.processIndex&&l.processIndex.length){l.processIndex.forEach(function(n){var a=c.actions[n],l=a.plugin,d=a.payload.type,f=o[l][d];if(f&&m(f)){var p,g=function(e,t){return void 0===e&&(e={}),void 0===t&&(t={}),[X,F].reduce(function(n,r){return e.hasOwnProperty(r)&&t[r]&&t[r]!==e[r]&&(n[r]=t[r]),n},e)}(a.payload,s),v=i[g.meta.rid];if(!v&&(p=f({payload:g,config:u[l].config,instance:r,abort:ce}))&&y(p)&&p.abort)return void(i[g.meta.rid]=!0);if(!v){var h=d+":"+l;e.dispatch(t({},g,{type:h,_:{called:h,from:"queueDrain"}}))}}});var d=c.actions.filter(function(e,t){return!~l.processIndex.indexOf(t)});c.actions=d}}}(o,n,e)},0),Promise.resolve(pe(u,n,e,o,r)).then(function(e){var t=a(e);return c=1,t})}();return Promise.resolve(x&&x.then?x.then(s):s(x))}catch(e){return Promise.reject(e)}}}}}function Ee(e){return function(t){return function(t){return function(n){var r=n.type,i=n.key,o=n.value,a=n.options;if(r===W.setItem||r===W.removeItem){if(n.abort)return t(n);r===W.setItem?e.setItem(i,o,a):e.removeItem(i,a)}return t(n)}}}}var Se=function(){var e=this;this.before=[],this.after=[],this.addMiddleware=function(t,n){e[n]=e[n].concat(t)},this.removeMiddleware=function(t,n){var r=e[n].findIndex(function(e){return e===t});-1!==r&&(e[n]=[].concat(e[n].slice(0,r),e[n].slice(r+1)))},this.dynamicMiddlewares=function(t){return function(n){return function(r){return function(i){var o={getState:n.getState,dispatch:function(e){return n.dispatch(e)}},a=e[t].map(function(e){return e(o)});return R.apply(void 0,a)(r)(i)}}}}};function ke(e){return function(n,r){void 0===n&&(n={});var i={};if("initialize:aborted"===r.type)return n;if(/^registerPlugin:([^:]*)$/.test(r.type)){var o=Oe(r.type,"registerPlugin"),a=e()[o];if(!a||!o)return n;var u=r.enabled,c=a.config;return i[o]={enabled:u,initialized:!!u&&Boolean(!a.initialize),loaded:!!u&&Boolean(a.loaded({config:c})),config:c},t({},n,i)}if(/^initialize:([^:]*)$/.test(r.type)){var s=Oe(r.type,W.initialize),l=e()[s];return l&&s?(i[s]=t({},n[s],{initialized:!0,loaded:Boolean(l.loaded({config:l.config}))}),t({},n,i)):n}if(/^ready:([^:]*)$/.test(r.type))return i[r.name]=t({},n[r.name],{loaded:!0}),t({},n,i);switch(r.type){case W.disablePlugin:return t({},n,je(r.plugins,!1,n));case W.enablePlugin:return t({},n,je(r.plugins,!0,n));default:return n}}}function Oe(e,t){return e.substring(t.length+1,e.length)}function je(e,n,r){return e.reduce(function(e,i){return e[i]=t({},r[i],{enabled:n}),e},r)}function Te(e){try{return JSON.parse(JSON.stringify(e))}catch(e){}return e}var Ae={last:{},history:[]};function Ne(e,n){void 0===e&&(e=Ae);var r=n.options,i=n.meta;if(n.type===W.track){var o=Te(t({event:n.event,properties:n.properties},Object.keys(r).length&&{options:r},{meta:i}));return t({},e,{last:o,history:e.history.concat(o)})}return e}var De={actions:[]};function Me(e,n){void 0===e&&(e=De);var r=n.payload;switch(n.type){case"queue":var i;return i=r&&r.type&&r.type===W.identify?[n].concat(e.actions):e.actions.concat(n),t({},e,{actions:i});case"dequeue":return[];default:return e}}var qe=/#.*$/;function ze(e){var t=/(http[s]?:\/\/)?([^\/\s]+\/)(.*)/g.exec(e);return"/"+(t&&t[3]?t[3].split("?")[0].replace(qe,""):"")}var Ce,Ue=function(e){if(void 0===e&&(e={}),!c)return e;var n=document,r=n.title,i=n.referrer,o=window,a=o.location,u=o.innerWidth,s=o.innerHeight,l=a.hash,d=a.search,f=function(e){var t=function(){if(c)for(var e,t=document.getElementsByTagName("link"),n=0;e=t[n];n++)if("canonical"===e.getAttribute("rel"))return e.getAttribute("href")}();return t?t.match(/\?/)?t:t+e:window.location.href.replace(qe,"")}(d),p={title:r,url:f,path:ze(f),hash:l,search:d,width:u,height:s};return i&&""!==i&&(p.referrer=i),t({},p,e)},Le={last:{},history:[]};function Re(e,n){void 0===e&&(e=Le);var r=n.options;if(n.type===W.page){var i=Te(t({properties:n.properties,meta:n.meta},Object.keys(r).length&&{options:r}));return t({},e,{last:i,history:e.history.concat(i)})}return e}Ce={};var Ve={initialized:!1,sessionId:P(),app:null,version:null,debug:!1,offline:!!c&&!navigator.onLine,os:{name:"na"},userAgent:c?navigator.userAgent:"node",library:{name:J,version:"0.0.0"},timezone:void 0,locale:void 0,campaign:{},referrer:Ce};function $e(e,n){void 0===e&&(e=Ve);var r=e.initialized,i=n.campaign;switch(n.type){case W.campaign:return t({},e,{campaign:i});case W.offline:return t({},e,{offline:!0});case W.online:return t({},e,{offline:!1});default:return r?e:t({},Ve,e,{initialized:!0})}}var Be=["plugins","reducers","storage"];function He(){return O(J,[]),function(e){return function(t,n,r){var i=e(t,n,r),o=i.dispatch;return Object.assign(i,{dispatch:function(e){return S[E][J].push(e.action||e),o(e)}})}}}function Je(e){return function(){return R(R.apply(null,arguments),He())}}function Xe(e){return e?function(e){return"array"===f(e)}(e)?e:[e]:[]}function Fe(e,n,r){void 0===e&&(e={});var i,o,a=P();return n&&(oe[a]=(i=n,o=function(e){for(var t,n=e||Array.prototype.slice.call(arguments),r=0;r<n.length;r++)if(m(n[r])){t=n[r];break}return t}(r),function(e){o&&o(e),i(e)})),t({},e,{rid:a,ts:(new Date).getTime()},n?{hasCallback:!0}:{})}function Ge(e){void 0===e&&(e={});var n=e.reducers||{},r=e.initialUser||{},i=(e.plugins||[]).reduce(function(e,t){if(m(t))return e.middlewares=e.middlewares.concat(t),e;if(t.NAMESPACE&&(t.name=t.NAMESPACE),!t.name)throw new Error("https://lytics.dev/errors/1");t.config||(t.config={});var n=t.EVENTS?Object.keys(t.EVENTS).map(function(e){return t.EVENTS[e]}):[];e.pluginEnabled[t.name]=!(!1===t.enabled||!1===t.config.enabled),delete t.enabled,t.methods&&(e.methods[t.name]=Object.keys(t.methods).reduce(function(e,n){var r;return e[n]=(r=t.methods[n],function(){for(var e=Array.prototype.slice.call(arguments),t=new Array(r.length),n=0;n<e.length;n++)t[n]=e[n];return t[t.length]=B,r.apply({instance:B},t)}),e},{}),delete t.methods);var r=Object.keys(t).concat(n),i=new Set(e.events.concat(r));if(e.events=Array.from(i),e.pluginsArray=e.pluginsArray.concat(t),e.plugins[t.name])throw new Error(t.name+"AlreadyLoaded");return e.plugins[t.name]=t,e.plugins[t.name].loaded||(e.plugins[t.name].loaded=function(){return!0}),e},{plugins:{},pluginEnabled:{},methods:{},pluginsArray:[],middlewares:[],events:[]}),o=e.storage?e.storage:{getItem:k,setItem:O,removeItem:j},u=function(e){return function(t,n,r){return n.getState("user")[t]||(r&&y(r)&&r[t]?r[t]:ne(e)[t]||k(re(t))||null)}}(o),s=i.plugins,l=i.events.filter(function(e){return!K.includes(e)}).sort(),d=new Set(l.concat(G).filter(function(e){return!K.includes(e)})),f=Array.from(d).sort(),p=function(){return s},v=new Se,h=v.addMiddleware,b=v.removeMiddleware,w=v.dynamicMiddlewares,_=function(){throw new Error("Abort disabled inListener")},E=function(e){for(var t,n=Object.create(null),r=/([^&=]+)=?([^&]*)/g;t=r.exec(e);){var i=x(t[1]),o=x(t[2]);"[]"===i.substring(i.length-2)?(n[i=i.substring(0,i.length-2)]||(n[i]=[])).push(o):n[i]=""===o||o}for(var a in n){var u=a.split("[");u.length>1&&(I(n,u.map(function(e){return e.replace(/[?[\]\\ ]/g,"")}),n[a]),delete n[a])}return n}(c&&window.location.search.substring(1)),S=ne(o),D=t({},S,r,E.an_uid?{userId:E.an_uid}:{},E.an_aid?{anonymousId:E.an_aid}:{});D.anonymousId||(D.anonymousId=P());var z=t({enable:function(e,t){return new Promise(function(n){se.dispatch({type:W.enablePlugin,plugins:Xe(e),_:{originalAction:W.enablePlugin}},n,[t])})},disable:function(e,t){return new Promise(function(n){se.dispatch({type:W.disablePlugin,plugins:Xe(e),_:{originalAction:W.disablePlugin}},n,[t])})}},i.methods),C=!1,B={identify:function(e,n,r,i){try{var o=g(e)?e:null,a=y(e)?e:n,c=r||{},s=B.user();O(re(X),o);var l=o||a.userId||u(X,B,a);return Promise.resolve(new Promise(function(e){se.dispatch(t({type:W.identifyStart,userId:l,traits:a||{},options:c,anonymousId:s.anonymousId},s.id&&s.id!==o&&{previousId:s.id}),e,[n,r,i])}))}catch(e){return Promise.reject(e)}},track:function(e,t,n,r){try{var i=y(e)?e.event:e;if(!i||!g(i))throw new Error("EventMissing");var o=y(e)?e:t||{},a=y(n)?n:{};return Promise.resolve(new Promise(function(e){se.dispatch({type:W.trackStart,event:i,properties:o,options:a,userId:u(X,B,t),anonymousId:u(F,B,t)},e,[t,n,r])}))}catch(e){return Promise.reject(e)}},page:function(e,t,n){try{var r=y(e)?e:{},i=y(t)?t:{};return Promise.resolve(new Promise(function(o){se.dispatch({type:W.pageStart,properties:Ue(r),options:i,userId:u(X,B,r),anonymousId:u(F,B,r)},o,[e,t,n])}))}catch(e){return Promise.reject(e)}},user:function(e){if(e===X||"id"===e)return u(X,B);if(e===F||"anonId"===e)return u(F,B);var t=B.getState("user");return e?a(t,e):t},reset:function(e){return new Promise(function(t){se.dispatch({type:W.resetStart},t,e)})},ready:function(e){return C&&e({plugins:z,instance:B}),B.on(W.ready,function(t){e(t),C=!0})},on:function(e,t){if(!e||!m(t))return!1;if(e===W.bootstrap)throw new Error(".on disabled for "+e);var n=/Start$|Start:/;if("*"===e){var r=function(e){return function(e){return function(r){return r.type.match(n)&&t({payload:r,instance:B,plugins:s}),e(r)}}},i=function(e){return function(e){return function(r){return r.type.match(n)||t({payload:r,instance:B,plugins:s}),e(r)}}};return h(r,Ke),h(i,We),function(){b(r,Ke),b(i,We)}}var o=e.match(n)?Ke:We,a=function(n){return function(n){return function(r){return r.type===e&&t({payload:r,instance:B,plugins:s,abort:_}),n(r)}}};return h(a,o),function(){return b(a,o)}},once:function(e,t){if(!e||!m(t))return!1;if(e===W.bootstrap)throw new Error(".once disabled for "+e);var n=B.on(e,function(e){t({payload:e.payload,instance:B,plugins:s,abort:_}),n()});return n},getState:function(e){var t=se.getState();return e?a(t,e):Object.assign({},t)},dispatch:function(e){var n=g(e)?{type:e}:e;if(G.includes(n.type))throw new Error("reserved action "+n.type);var r=t({},n,{_:t({originalAction:n.type},e._||{})});se.dispatch(r)},enablePlugin:z.enable,disablePlugin:z.disable,plugins:z,storage:{getItem:o.getItem,setItem:function(e,t,n){se.dispatch({type:W.setItemStart,key:e,value:t,options:n})},removeItem:function(e,t){se.dispatch({type:W.removeItemStart,key:e,options:t})}},setAnonymousId:function(e,t){B.storage.setItem($,e,t)},events:{core:G,plugins:l}},H=i.middlewares.concat([function(e){return function(e){return function(t){return t.meta||(t.meta=Fe()),e(t)}}},w(Ke),Pe(B,p,{all:f,plugins:l}),Ee(o),ee(B),ie(B),w(We)]),J={context:$e,user:te(o),page:Re,track:Ne,plugins:ke(p),queue:Me},Q=R,Y=R;if(c&&e.debug){var Z=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__;Z&&(Q=Z({trace:!0,traceLimit:25})),Y=function(){return 0===arguments.length?He():y(typeof arguments[0])?Je():Je().apply(null,arguments)}}var oe,ae=function(e){return Object.keys(e).reduce(function(t,n){return Be.includes(n)||(t[n]=e[n]),t},{})}(e),ue=i.pluginsArray.reduce(function(e,t){var n=t.name,r=t.config,o=t.loaded,a=i.pluginEnabled[n];return e[n]={enabled:a,initialized:!!a&&Boolean(!t.initialize),loaded:Boolean(o({config:r})),config:r},e},{}),ce={context:ae,user:D,plugins:ue},se=U(function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var i=t[r];typeof e[i]===T&&(n[i]=e[i])}var o,a=Object.keys(n);try{!function(e){Object.keys(e).forEach(function(t){var n=e[t];if(typeof n(void 0,{type:M})===A||typeof n(void 0,{type:q})===A)throw new Error(N+" "+t+" "+A)})}(n)}catch(e){o=e}return function(e,t){if(void 0===e&&(e={}),o)throw o;for(var r=!1,i={},u=0;u<a.length;u++){var c=a[u],s=e[c],l=(0,n[c])(s,t);if(typeof l===A){var d=L(c,t);throw new Error(d)}i[c]=l,r=r||l!==s}return r?i:e}}(t({},J,n)),ce,Y(Q(V.apply(void 0,H))));se.dispatch=(oe=se.dispatch,function(e,n,r){var i=t({},e,{meta:Fe(e.meta,n,Xe(r))});return oe.apply(null,[i])});var le=Object.keys(s);se.dispatch({type:W.bootstrap,plugins:le,config:ae,params:E,user:D,initialUser:r,persistedUser:S});var de=le.filter(function(e){return i.pluginEnabled[e]}),fe=le.filter(function(e){return!i.pluginEnabled[e]});return se.dispatch({type:W.registerPlugins,plugins:le,enabled:i.pluginEnabled}),i.pluginsArray.map(function(e,t){var n=e.bootstrap,r=e.config,o=e.name;n&&m(n)&&n({instance:B,config:r,payload:e}),se.dispatch({type:W.registerPluginType(o),name:o,enabled:i.pluginEnabled[o],plugin:e}),i.pluginsArray.length===t+1&&se.dispatch({type:W.initializeStart,plugins:de,disabled:fe})}),B}var Ke="before",We="after",Qe="pv",Ye="ue",Ze="spangle_uuid";function et(){var e,t,n,r,i,o=function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(13,i.length)}return null}(Ze);return o||(o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),e=Ze,t=o,n="."+document.domain.split(".").slice(-2).join("."),(i=new Date).setTime(i.getTime()+2592e6),r="; expires="+i.toUTCString(),document.cookie=e+"="+(t||"")+r+";;domain="+n+";path=/; Secure"),o}var tt=/*#__PURE__*/r("clientId"),nt=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,tt,{writable:!0,value:void 0}),i(this,tt)[tt]=e.clientId||et(),this.analytics=Ge({app:e.app||"DEFAULT",debug:e.debug||!1,plugins:[{name:"spangle-plugin",config:{},initialize:function(e){console.log("spangle-plugin load")},page:function(e){},track:function(e){!function(e,t,n,r,i,o){void 0===r&&(r=null),void 0===i&&(i=0),void 0===o&&(o=1e3);var a=new XMLHttpRequest;!function e(t){a.open("POST","https://c.spangle.ai/v1/t",!0),a.onreadystatechange=function(){4===a.readyState&&(200===a.status?r&&r(a.responseText):t>0?setTimeout(function(){e(t-1)},o):console.error("Request failed after "+i+" retries."))},a.setRequestHeader("Content-Type","application/json"),a.send(JSON.stringify(n))}(i)}(0,0,e.payload.properties)},identify:function(e){},loaded:function(){return!0}}]})}var t=e.prototype;return t.trackPageView=function(e){return this.analytics.track("pv",{id:et(),ev:"pv",ts:(new Date).getTime(),as:e.deviceType,eu:currentURL,"ud[em]":e.user.email,"ud[ph]":e.user.phone,"ud[ge]":null,"cd[currency]":e.currency||"USD",visitor_id:e.visitorId,session_id:e.sessionId,client_event_time:Date.now(),client_id:i(this,tt)[tt],page_url:window.location.href,referer:window.document.referrer})},t.trackProductView=function(e){return this.analytics.track(Qe,{e:Qe,page:e.title,eid:et(),visitor_id:e.visitorId,session_id:e.sessionId,client_event_time:Date.now(),client_id:i(this,tt)[tt],item_id:e.product.id,product_name:e.product.name})},t.trackProductListView=function(e){return this.analytics.track(Qe,{e:Qe,page:e.title,eid:et(),visitor_id:e.visitorId,session_id:e.sessionId,client_event_time:Date.now(),client_id:i(this,tt)[tt],item_list_id:e.product.id,item_search_keyword:e.product.search_keyword,item_category:e.product.category})},t.trackAddToCart=function(e){return this.analytics.track(Ye,{id:et(),ev:Ye,ts:(new Date).getTime(),as:"website",eu:window.location.href,"ud[em]":e.user.email,"ud[ph]":e.user.phone,"ud[ge]":null,"cd[currency]":e.currency||"USD","cd[value]":price,visitor_id:e.visitorId,session_id:e.sessionId,client_event_time:Date.now(),client_id:i(this,tt)[tt],item_id:e.product.id,sku_id:e.product.variantId,quantity:e.product.quantity})},t.trackRemoveFromCart=function(e){return this.analytics.track(Ye,{id:et(),ev:Ye,ts:(new Date).getTime(),as:"website",eu:window.location.href,"ud[em]":e.user.email,"ud[ph]":e.user.phone,"ud[ge]":null,"cd[currency]":e.currency||"USD","cd[value]":price,visitor_id:e.visitorId,session_id:e.sessionId,client_event_time:Date.now(),client_id:i(this,tt)[tt],item_id:e.product.id,sku_id:e.product.variantId,quantity:e.product.quantity})},t.trackPurchase=function(e){return this.analytics.track("ue",{id:et(),ev:"ue",ts:Date.now(),as:e.deviceType,eu:window.location.href,"ud[em]":e.user.email,"ud[ph]":e.user.phone,"ud[ge]":null,"cd[currency]":e.currency||"USD","cd[value]":price,visitor_id:e.visitorId,session_id:e.sessionId,client_event_time:Date.now(),client_id:i(this,tt)[tt],order_id:e.order.id,customer_email:e.order.email,currency_code:e.currency,order_promo_code:e.order.orderPromocode,order_discount:e.order.orderDiscount,shipping_cost:e.order.shippingCost,productList:e.items.map(function(e){return{item_id:e.id,item_category:e.category,item_brand:e.brand,price:e.price,quantity:e.quantity}}),sub_total:e.order.subTotal,order_tax:e.order.orderTax,order_source:e.deviceType})},e}(),rt=null;e.createTracker=function(e){return rt||(rt=new nt({app:"GTM_TRACKER",debug:!1,clientId:e})),rt}});
//# sourceMappingURL=GTM.umd.js.map
